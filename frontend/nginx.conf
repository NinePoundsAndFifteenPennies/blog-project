server {
    listen 80;
    listen 443 ssl;
    server_name myblogsystem.icu;  # 已修改为您的域名

    # SSL 证书配置
    # 请确保您已经为 myblogsystem.icu 申请了 SSL 证书
    # 并将路径替换为您的实际证书路径
    ssl_certificate /etc/letsencrypt/live/myblogsystem.icu/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/myblogsystem.icu/privkey.pem;

    # HTTP 重定向到 HTTPS
    if ($scheme = http) {
        return 301 https://$host$request_uri;
    }

    # 网站根目录，请根据您的实际情况修改
    root /usr/share/nginx/html;
    index index.html;

    # 前端路由支持 (适用于单页面应用，如 Vue, React, Angular)
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 后端 API 代理
    location /api {
        # 假设您的后端服务在名为 "backend" 的容器或主机上，端口为 8080
        # 如果不是，请修改为您的后端服务的实际地址和端口，例如 http://127.0.0.1:8080
        proxy_pass http://backend:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    }
    
    # Let's Encrypt 验证目录
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }
}
